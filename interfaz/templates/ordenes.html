{% extends 'base.html' %}

{% block content %}
<div class="content">
    <div class="header-section">
        <div>
            <h1>Órdenes de Trabajo</h1>
            <p class="subtitle">Gestión de servicios y visitas técnicas</p>
        </div>
        <div class="flex gap-2">
            <a href="{{ url_for('nueva_orden', tipo='desazolve') }}" class="btn btn-primary">+ Nuevo Desazolve</a>
            <a href="{{ url_for('nueva_orden', tipo='trampa') }}" class="btn btn-primary">+ Nueva Trampa</a>
            <a href="{{ url_for('nueva_orden', tipo='visita') }}" class="btn btn-primary">+ Nueva Visita</a>
        </div>
    </div>
</div>

<div style="margin-bottom: 1.5rem; display: flex; gap: 1rem;">
    <button onclick="showTab('desazolve')" id="btn-desazolve" class="btn btn-primary">Desazolves</button>
    <button onclick="showTab('trampas')" id="btn-trampas" class="btn btn-secondary">Trampas de Grasa</button>
    <button onclick="showTab('visitas')" id="btn-visitas" class="btn btn-secondary">Visitas Técnicas</button>
</div>

<!-- DESAZOLVES -->
<div id="tab-desazolve" class="card table-container">
    <h3>Ordenes de Desazolve</h3>
    <table>
        <thead>
            <tr>
                <th>Folio</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Ubicación</th>
                <th>Servicio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for orden in desazolves|reverse %}
            {% if orden.folio_des %}
            <tr>
                <td><strong>{{ orden.folio_des }}</strong></td>
                <td>{{ orden.fecha_des }}</td>
                <td>{{ orden.nombre_cliente }}</td>
                <td>{{ orden.ubicacion_area }}</td>
                <td>
                    {% if orden.equipo_vactor == 'x' %}Vactor{% endif %}
                    {% if orden.equipo_hidro == 'x' %}Hidro{% endif %}
                    {% if orden.equipo_guia == 'x' %}Guía{% endif %}
                </td>
                <td>
                    <a href="{{ url_for('detalle_orden', tipo='desazolve', folio=orden.folio_des) }}"
                        class="btn btn-secondary btn-small">Ver Detalle</a>
                </td>
            </tr>
            {% endif %}
            {% else %}
            <tr>
                <td colspan="7" class="text-center text-muted p-8">No hay órdenes de desazolve registradas.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- TRAMPAS -->
<div id="tab-trampas" class="card table-container hidden">
    <h3>Limpieza de Trampas</h3>
    <table>
        <thead>
            <tr>
                <th>Folio</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Tipo</th>
                <th>Capacidad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for orden in trampas|reverse %}
            {% if orden.folio_lt %}
            <tr>
                <td><strong>{{ orden.folio_lt }}</strong></td>
                <td>{{ orden.fecha_lt }}</td>
                <td>{{ orden.nombre_cliente }}</td>
                <td>{{ orden.tipo_trampa }}</td>
                <td>{{ orden.capacidad_trampa }}</td>
                <td>
                    <a href="{{ url_for('detalle_orden', tipo='trampa', folio=orden.folio_lt) }}"
                        class="btn btn-secondary btn-small">Ver Detalle</a>
                </td>
            </tr>
            {% endif %}
            {% else %}
            <tr>
                <td colspan="6" class="text-center text-muted p-8">No hay órdenes de trampas registradas.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- VISITAS -->
<div id="tab-visitas" class="card table-container hidden">
    <h3>Visitas Técnicas</h3>
    <table>
        <thead>
            <tr>
                <th>Folio VT</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Dirección</th>
                <th>No. Cliente</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for orden in visitas|reverse %}
            {% if orden.folio_vt %}
            <tr>
                <td><strong>{{ orden.folio_vt }}</strong></td>
                <td>{{ orden.fecha_vt }}</td>
                <td>{{ orden.nombre_cliente }}</td>
                <td>{{ orden.direccion_cliente }}</td>
                <td>{{ orden.no_cliente }}</td>
                <td>
                    <a href="{{ url_for('detalle_orden', tipo='visita', folio=orden.folio_vt) }}"
                        class="btn btn-secondary btn-small">Ver Detalle</a>
                </td>
            </tr>
            {% endif %}
            {% else %}
            <tr>
                <td colspan="6" class="text-center text-muted p-8">No hay visitas técnicas registradas.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<script>
    function showTab(tabName) {
        // Hide all
        document.getElementById('tab-desazolve').classList.add('hidden');
        document.getElementById('tab-trampas').classList.add('hidden');
        document.getElementById('tab-visitas').classList.add('hidden');

        // Show selected
        document.getElementById('tab-' + tabName).classList.remove('hidden');

        // Update buttons
        document.querySelectorAll('button').forEach(btn => {
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-secondary');
        });

        // Highlight active btn
        const activeBtn = document.getElementById('btn-' + tabName);
        activeBtn.classList.remove('btn-secondary');
        activeBtn.classList.add('btn-primary');
    }
</script>
{% endblock %}