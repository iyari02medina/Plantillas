{% extends 'base.html' %}

{% block content %}
<header>
    <h1>Nueva Cotización</h1>
    <p class="subtitle">Complete el formulario para registrar una nueva cotización.</p>
</header>

<form action="{{ url_for('nueva_cotizacion') }}" method="POST" class="card">

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
        <div class="form-group">
            <label for="folio_cot">Folio Cotización</label>
            <input type="text" id="folio_cot" name="folio_cot" placeholder="Ej. COT-COPHI-001"
                value="{{ suggested_folio }}" required>
        </div>
        <div class="form-group">
            <label for="fecha_cot">Fecha</label>
            <input type="date" id="fecha_cot" name="fecha_cot">
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
        <div class="form-group" style="position: relative;">
            <label for="nombre_cliente">Cliente</label>
            <input type="text" id="nombre_cliente" name="nombre_cliente" placeholder="Buscar o escribir nuevo..."
                autocomplete="off" oninput="fillClient(this)" required>
            <div id="suggestions-box"></div>
        </div>
        <div class="form-group">
            <label for="razon_social_cliente">Razón Social</label>
            <input type="text" id="razon_social_cliente" name="razon_social_cliente">
        </div>
        <div class="form-group" style="grid-column: span 2;">
            <label for="direccion_cliente">Dirección</label>
            <input type="text" id="direccion_cliente" name="direccion_cliente">
        </div>
        <div class="form-group">
            <label for="nombre_contacto">Contacto</label>
            <input type="text" id="nombre_contacto" name="nombre_contacto">
        </div>
        <div class="form-group">
            <label for="telefono_contacto">Teléfono</label>
            <input type="text" id="telefono_contacto" name="telefono_contacto">
        </div>
    </div>

    <h3>Detalles del Servicio</h3>
    <div class="form-group">
        <label for="alcance_cot">Alcance (Descripción General)</label>
        <textarea id="alcance_cot" name="alcance_cot" rows="3"></textarea>
    </div>

    <h3>Items / Conceptos</h3>
    <div id="items-container">
        <!-- Javascript will populate this -->
    </div>

    <button type="button" class="btn btn-secondary mb-4" onclick="addItem()">+ Agregar Item</button>

    <h3>Términos y Condiciones</h3>
    <div class="form-group">
        <label for="terminos">Texto de Términos</label>
        <textarea id="terminos" name="terminos"
            rows="4">El pago se realizará 50% anticipo y 50% contra entrega. Precios más IVA. Validez de la oferta: 15 días.</textarea>
    </div>

    <div style="text-align: right; margin-top: 2rem;">
        <a href="{{ url_for('cotizaciones') }}" class="btn btn-secondary" style="margin-right: 1rem;">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar Cotización</button>
    </div>
</form>

<!-- Datalist for items (hidden, used by JS) -->
<datalist id="inventory_list">
    {% for item in inventario %}
    <option value="{{ item.Nombre }}" data-desc="{{ item.Nombre }}" data-unit="{{ item.Unidad }}"
        data-price="{{ item.Precio }}">{{ item.Nombre }}</option>
    {% endfor %}
</datalist>

<script>
    const clientsData = {{ clientes| tojson }};
</script>
<script src="{{ url_for('static', filename='crear_cotizacion.js') }}"></script>
{% endblock %}